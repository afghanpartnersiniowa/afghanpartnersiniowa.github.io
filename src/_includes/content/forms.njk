{% macro form(name, action, xData, method='post') %}
  <form name="{{ name }}"
        action="{{ action }}"
        method="{{ method }}"
        x-data="{{ xData }}"
        x-init="$watch('form.submitCount', () => { form.errors = Object.keys(form).some(k => Boolean(form[k].validate) && form[k].validate(form)); form.errors ? window.scrollTo(0,0) : submitContactForm() })">
    <p x-cloak class="text-secondary-400 mb-6" x-show="form.errors">Please correct the errors below before submitting</p>
    <p class="required mb-4">Required</p>
    <input class="hidden" name="recaptchaToken" value="">
    {{ caller() }}
  </form>
{% endmacro %}

{% macro button(text, name, type='submit', class='') %}
  <button name="{{ name }}" type="{{ type }}"
          class="border border-primary-500 bg-primary-500 text-white rounded-md px-4 py-2 m-2 transition duration-500 ease select-none hover:bg-primary-600 focus:outline-none focus:shadow-outline {{ class }}"
  >{{ text }}</button>
{% endmacro %}

{% macro input(name, value='', type='text', placeholder='', class='', rows='4', model='', validate=false, id='') %}
  {% if type === 'textarea' %}
    <textarea name="{{ name }}" :id="'{{ id }}' || '{{ name }}'"
              value="{{ value | escape }}"
              class="peer block w-full rounded-md border-gray-300 focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ class }}"
              placeholder="{{ placeholder }}"
              rows="{{ rows }}"
              x-model="{{ model }}.value"
              x-init="$watch('form.submitCount', () => $el.setCustomValidity({{ model }}.validate(form) ? 'Invalid field.' : ''))">
    ></textarea>
  {% else %}  
    <input type="{{ type }}" name="{{ name }}" :id="'{{ id }}' || '{{ name }}'"
           value="{{ value | escape }}"
           class="peer block w-full rounded-md border-gray-300 focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ class }}"
           placeholder="{{ placeholder }}"
           x-model="{{ model }}.value"
           x-init="{{ validate }} && $watch('form.submitCount', () => $el.setCustomValidity({{ model }}.validate(form) ? 'Invalid field.' : ''))">
  {% endif %}
{% endmacro %}

{% macro fieldset(legend, items, legendClass='', type='checkbox', name='', model='', emptyText='') %}
  <fieldset class="sm:grid sm:grid-cols-2">
    <legend class="mb-4 {{ legendClass }}">{{ legend }}</legend>
    {% for item in items %}
      <div class="mb-2">
        <input type="{{ type }}" value="{{ item }}" name="{{ name }}" id="{{ name }}_{{ loop.index }}"
               class="border-gray-300 focus:ring-3 focus:ring-primary-300 rounded mr-2"
               x-model="{{ model }}.value">
        <label for="{{ name }}_{{ loop.index }}">{{ item }}</label>
      </div>
    {% endfor %}
  </fieldset>
  {% if emptyText %}
    <p class="text-secondary-400 text-sm mb-2 invisible error-label"
        x-init="{{ emptyText.length }} && $watch('form.submitCount', () => {{ model }}.validate(form) ? $el.classList.remove('invisible') : $el.classList.add('invisible'))">
      {{ emptyText }}
    </p>
  {% endif %}
{% endmacro %}

{% macro label(text, forHtml, class='') %}
  <label for="{{ forHtml }}" class="{{ class }}">{{ text }}</label>
{% endmacro %}

{% macro field(
  text,
  name,
  value='',
  type='text',
  placeholder='',
  inputClass='',
  rows='4',
  model='',
  labelClass='',
  emptyText='',
  invalidText=''
) %}
  <div>
    {{ label(text, name, labelClass) }}
    {{ input(name, value, type, placeholder, inputClass, rows, model, emptyText.length) }}
    {% if emptyText %}
      {{ error(model, emptyText, invalidText) }}
    {% endif %}
  </div>
{% endmacro %}

{% macro error(model, emptyText, invalidText) %}
  <p
    class="error-label text-secondary-400 text-sm invisible peer-invalid:visible mb-2"
    x-data x-text="{{ model }}.value.length ? '{{ invalidText }}' : '{{ emptyText }}'">
  </p>
{% endmacro %}

{% macro recaptchaScript(siteKey, formName) %}
  <script async src="https://www.google.com/recaptcha/api.js?render={{ siteKey }}"></script>

  <script>
    function submitContactForm() {
      grecaptcha.ready(function() {
        grecaptcha.execute('{{ siteKey }}', { action: 'submit' }).then(function(token) {
          document.querySelector('input[name="recaptchaToken"]').value = token;
          document.querySelector('form[name="{{ formName }}"]').submit();
        });
      });
    }
  </script>
{% endmacro %}

{% macro recaptchaDisclaimer() %}
  <p class="text-sm font-light mb-4">
    This site is protected by reCAPTCHA and the Google
    <a href="https://policies.google.com/privacy" class="external">Privacy Policy</a> and
    <a href="https://policies.google.com/terms" class="external">Terms of Service</a> apply.
  </p>
{% endmacro %}